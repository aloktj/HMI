<!--
  TRDP config DB XML for Door HMI endpoint
  Based on gateway PoC definition but converted for HMI role.

  PD 2001: DoorStatusAggregated (Gateway -> HMI), sink, supports multicast + unicast
  PD 2002: HMIStatus_PD (HMI -> Gateway), source
  MD 2101: DoorCommandAggregated (HMI -> Gateway), source
  MD 2102: GatewayCommandToHMI (Gateway -> HMI), sink
-->
<device host-name="HMI_01" type="HMI">
  <debug level="I" info="AD" file-name="trdp_hmi.log" file-size="1048576"/>

  <data-set-list>
    <data-set id="1010" name="DoorSlot8B">
      <element name="door_state" type="UINT8" array-size="1"/>
      <element name="obstruction" type="UINT8" array-size="1"/>
      <element name="last_cmd" type="UINT8" array-size="1"/>
      <element name="close_blocked" type="UINT8" array-size="1"/>
      <element name="status_counter" type="UINT8" array-size="1"/>
      <element name="reserved5" type="UINT8" array-size="1"/>
      <element name="reserved6" type="UINT8" array-size="1"/>
      <element name="reserved7" type="UINT8" array-size="1"/>
    </data-set>

    <data-set id="1001" name="DoorStatusAggregated">
      <element name="doors" type="1010" array-size="8"/>
    </data-set>

    <data-set id="1020" name="CmdSlot2B">
      <element name="cmd" type="UINT8" array-size="1"/>
      <element name="alive_counter" type="UINT8" array-size="1"/>
    </data-set>

    <data-set id="1002" name="DoorCommandAggregated">
      <element name="doors" type="1020" array-size="8"/>
    </data-set>
  </data-set-list>

  <com-parameter-list>
    <com-parameter id="1" qos="5" ttl="64" retries="0"/>
  </com-parameter-list>

  <bus-interface-list>
    <bus-interface network-id="1" name="eth0" host-ip="192.168.56.2">
      <trdp-process cycle-time="10000" vlan-id="0" blocking="no" traffic-shaping="on" priority="64"/>
      <pd-com-parameter timeout-value="300000" validity-behavior="zero" ttl="64" qos="5" marshall="off" callback="off" port="17224"/>
      <md-com-parameter confirm-timeout="1000000" reply-timeout="5000000" connect-timeout="60000000" ttl="64" qos="3" retries="2" protocol="UDP" marshall="off" callback="off" udp-port="17225" tcp-port="17225" num-sessions="1000"/>

      <!-- PD sink: Gateway publishes to HMI via multicast and/or unicast -->
      <telegram name="DoorStatusAggregated_PD_RX" com-id="2001" data-set-id="1001" com-parameter-id="1" type="sink" create="off">
        <pd-parameter cycle="100000" timeout="300000" validity-behavior="zero" redundant="0" marshall="off" callback="off" offset-address="0"/>
        <source id="1" uri1="ip:192.168.56.1" name="GW_DOOR_01"/>
        <destination id="101" uri="mcast:239.192.0.1" name="HMI_MCAST_A"/>
        <destination id="102" uri="mcast:239.192.0.2" name="HMI_MCAST_B"/>
        <destination id="201" uri="ip:192.168.56.2" name="HMI_UNICAST_01"/>
      </telegram>

      <!-- PD source: HMI status heartbeat back to gateway -->
      <telegram name="HMIStatus_PD_TX" com-id="2002" data-set-id="1002" com-parameter-id="1" type="source" create="off">
        <pd-parameter cycle="100000" timeout="300000" validity-behavior="zero" redundant="0" marshall="off" callback="off" offset-address="0"/>
        <source id="1" uri1="ip:192.168.56.2" name="HMI_UNICAST_01"/>
        <destination id="1" uri="ip:192.168.56.1" name="GW_DOOR_01"/>
      </telegram>

      <!-- MD source: command/event from HMI to gateway -->
      <telegram name="DoorCommandAggregated_MD_TX" com-id="2101" data-set-id="1002" com-parameter-id="1" type="source" create="off">
        <md-parameter protocol="UDP" marshall="off" callback="off"/>
        <source id="1" uri1="ip:192.168.56.2" name="HMI_UNICAST_01"/>
        <destination id="1" uri="ip:192.168.56.1" name="GW_DOOR_01"/>
      </telegram>

      <!-- MD sink: optional command/result path from gateway to HMI -->
      <telegram name="GatewayCommandToHMI_MD_RX" com-id="2102" data-set-id="1002" com-parameter-id="1" type="sink" create="off">
        <md-parameter protocol="UDP" marshall="off" callback="off"/>
        <source id="1" uri1="ip:192.168.56.1" name="GW_DOOR_01"/>
        <destination id="1" uri="ip:192.168.56.2" name="HMI_UNICAST_01"/>
      </telegram>
    </bus-interface>
  </bus-interface-list>
</device>
